<!DOCTYPE html>
<html>
  <head>
   <meta charset='utf-8' />
   <link rel="stylesheet" src="style.css" />
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
   <script src="https://apis.google.com/js/client.js"></script>
   <script type="text/javascript">
    const account = {
      "client_id":"1062350666504-d0qftfu459cecmo1140p9dl9krcbf6mm.apps.googleusercontent.com",
      "project_id":"send-mail-310502","auth_uri":"https://accounts.google.com/o/oauth2/auth",
      "token_uri":"https://oauth2.googleapis.com/token",
      "auth_provider_x509_cert_url":
      "https://www.googleapis.com/oauth2/v1/certs",
      "client_secret":"5gQwoWV-2Cpmzsqkgtp_NKhK"
    }
  
     var PROJECT_ID = account.project_id;
     var CLIENT_ID = account.client_id;
     var API_KEY = account.api_key;
     var SCOPES = ['https://www.googleapis.com/auth/gmail.send'].join(' ');


     var API_VERSION = 'v1';


     function initializeApi() {
       gapi.client.load('compute', API_VERSION);
     }
     

     /**
      * Authorize Google Compute Engine API.
      */
     function authorization() {
       gapi.client.setApiKey(API_KEY);
       gapi.auth.authorize({
         client_id: CLIENT_ID,
         scope: SCOPES,
         immediate: true
       }, function(authResult) {
            if (authResult && !authResult.error) {
              // window.alert('Auth was successful!');
              initializeApi();
            } else {
              window.alert('Auth was not successful');
            }
          }
       );
     }

     /**
      * Driver for sample application.
      */
     $(window).load(authorization);


     async function sendEmail() {
      try {
        // 送りたいメールアドレスに書き換えてください。
        const to = 'a-araki@rozetta.jp';
        const subject = 'テスト';
        const body = 'これはテストです。';

        // メールデータの作成。
        const mimeData = [
          `To: ${to}`,
          'Subject: =?utf-8?B?' + btoa(unescape(encodeURIComponent(subject))) + '?=',
          'MIME-Version: 1.0',
          'Content-Type: text/plain; charset=UTF-8',
          'Content-Transfer-Encoding: 7bit',
          '',
          body,
        ].join('\n').trim();
        const raw = btoa(unescape(encodeURIComponent(mimeData))).replace(/\+/g, '-').replace(/\//g, '_');

        // メールの送信。
        await gapi.client.gmail.users.messages.send({
          'userId': 'me',
          'resource': {raw: raw},
        });
        console.log('Sent email');

      } catch (e) {
        console.error(e);
      }
    }
     
    </script>
  </head>
  <body>
    <button onclick="sendEmail()">Send email</button>
  </body>
</html>
